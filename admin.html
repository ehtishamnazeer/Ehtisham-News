<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>EHTISHAM | News Control Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Orbitron:wght@700&display=swap" rel="stylesheet">

<style>
:root { --gold: #c9a23f; --bg: #050505; --card: rgba(255,255,255,0.03); --border: rgba(255,255,255,0.08); }
body { margin:0; font-family:'Inter', sans-serif; background:var(--bg); color:#fff; overflow-x:hidden; background-image: radial-gradient(circle at 50% 0%, #1a150a 0%, #050505 70%); }

header { padding: 40px 20px; text-align: center; border-bottom: 1px solid var(--border); }
header h2 { font-family: 'Orbitron'; color: var(--gold); letter-spacing: 3px; font-size: 1.5rem; }

.container { padding: 20px; max-width: 800px; margin: 0 auto; }

/* Dashboard Stats */
.stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
.stat-card { background: var(--card); border: 1px solid var(--border); padding: 15px; border-radius: 15px; text-align: center; }
.stat-card h4 { font-size: 0.7rem; color: #555; text-transform: uppercase; letter-spacing: 1px; }
.stat-card p { font-size: 1.5rem; font-weight: 800; color: var(--gold); }

.card { background: var(--card); border: 1px solid var(--border); padding: 25px; border-radius: 24px; margin-bottom: 20px; backdrop-filter: blur(10px); }
h3 { font-family: 'Orbitron'; font-size: 1rem; margin-bottom: 20px; color: #fff; border-left: 3px solid var(--gold); padding-left: 10px; }

input, textarea, select { width: 100%; padding: 14px; margin: 10px 0; background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 12px; color: #fff; font-size: 0.9rem; }
input:focus { border-color: var(--gold); outline: none; }

button { background: var(--gold); color: #000; border: none; padding: 15px; border-radius: 12px; width: 100%; cursor: pointer; font-weight: 800; text-transform: uppercase; transition: 0.3s; }
button:active { transform: scale(0.96); }
button.danger { background: transparent; color: #ff4444; border: 1px solid #ff4444; padding: 8px 15px; width: auto; font-size: 0.7rem; }

.news-item { background: rgba(255,255,255,0.01); border: 1px solid var(--border); padding: 15px; border-radius: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
.news-info b { display: block; font-size: 1rem; margin-bottom: 4px; }
.news-info span { font-size: 0.7rem; color: var(--gold); background: rgba(201,162,63,0.1); padding: 2px 8px; border-radius: 5px; }

.status-msg { text-align: center; margin-top: 10px; font-size: 0.8rem; font-weight: 600; }
</style>
</head>

<body>

<header>
  <h2>EHTISHAM <span>ADMIN</span></h2>
  <p style="font-size: 10px; color: #444; letter-spacing: 2px;">COMMAND CENTER V2.0</p>
</header>

<div class="container">
  
  <div class="stats">
    <div class="stat-card"><h4>Total News</h4><p id="totalCount">0</p></div>
    <div class="stat-card"><h4>Live Sector</h4><p>Active</p></div>
  </div>

  <div class="card">
    <h3>Publish News</h3>
    <input id="title" placeholder="Catchy Headline">
    <textarea id="content" rows="4" placeholder="Full report / Details..."></textarea>
    <select id="category">
      <option value="">Select Sector</option>
      <option value="gaming">Gaming</option>
      <option value="esports">Esports</option>
      <option value="community">Community</option>
    </select>
    <button onclick="addNews()">Transmit Data</button>
    <div class="status-msg" id="status"></div>
  </div>

  <div class="card">
    <h3>Broadcast Alert</h3>
    <input id="notifyText" placeholder="Short alert message...">
    <button onclick="sendNotification()" style="background:#fff; color:#000;">Send Notification</button>
  </div>

  <div class="card">
    <h3>Live Stream Feed</h3>
    <div id="newsList">Scanning...</div>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, serverTimestamp,
  query, orderBy, onSnapshot, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC9Cfh60ZyeZTbhK45a_sKWBFCy8DrqDao",
  authDomain: "ehtisham-news.firebaseapp.com",
  projectId: "ehtisham-news",
  storageBucket: "ehtisham-news.appspot.com",
  messagingSenderId: "52980900534",
  appId: "1:52980900534:web:3595bef67929dd1c727c17"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ADD NEWS FIX: Using 'date' instead of 'createdAt' to sync with main site
window.addNews = async ()=>{
  const title = titleEl.value.trim();
  const content = contentEl.value.trim();
  const category = categoryEl.value;
  
  if(!title || !content || !category){
    statusEl.style.color="#ff4444"; statusEl.innerText="âš ï¸ Data incomplete"; return;
  }
  
  statusEl.innerText="ðŸ“¡ Transmitting...";
  
  try {
    await addDoc(collection(db,"news"),{
      title, 
      content, 
      category,
      status: "published",
      date: serverTimestamp() // Main site uses 'date'
    });
    statusEl.style.color="#00ff88"; statusEl.innerText="âœ”ï¸ Data Published to Index";
    titleEl.value=""; contentEl.value=""; categoryEl.value="";
  } catch(e) {
    statusEl.innerText="âŒ Transmission Failed";
  }
};

window.sendNotification = async ()=>{
  const text = notifyText.value.trim();
  if(!text) return;
  await addDoc(collection(db,"notifications"),{ text, date: serverTimestamp() });
  notifyText.value="";
  alert("Notification Broadcasted");
};

// Real-time List + Stats
const q = query(collection(db,"news"), orderBy("date","desc"));
onSnapshot(q,(snap)=>{
  let html="";
  document.getElementById('totalCount').innerText = snap.size;
  snap.forEach(d=>{
    const n=d.data();
    html+=`
      <div class="news-item">
        <div class="news-info">
          <b>${n.title}</b>
          <span>${n.category.toUpperCase()}</span>
        </div>
        <button class="danger" onclick="deleteNews('${d.id}')">ERASE</button>
      </div>`;
  });
  newsList.innerHTML = html || "No data in sectors.";
});

window.deleteNews = async (id)=>{
  if(confirm("Erase this data permanently?")){
    await deleteDoc(doc(db,"news",id));
  }
};

const titleEl = document.getElementById("title");
const contentEl = document.getElementById("content");
const categoryEl = document.getElementById("category");
const statusEl = document.getElementById("status");
const notifyText = document.getElementById("notifyText");
const newsList = document.getElementById("newsList");
</script>

</body>
</html>
