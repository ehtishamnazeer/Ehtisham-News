<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Ehtisham News</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
header{background:#c9a23f;color:#fff;padding:15px;text-align:center}
.container{padding:15px}
.card{background:#fff;padding:15px;border-radius:12px;margin-bottom:15px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
input,textarea,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
button{background:#c9a23f;color:#fff;border:none;padding:12px;border-radius:10px;width:100%;cursor:pointer}
button.danger{background:#e74c3c}
button.small{width:auto;padding:6px 10px;border-radius:6px}
.status{text-align:center;margin-top:10px;font-weight:bold}
.news-item{border-bottom:1px solid #eee;padding:8px 0}
.news-item small{color:#777}
.flex{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>

<body>

<header>
  <h2>Admin Panel</h2>
  <p>Publish â€¢ Delete â€¢ Notify</p>
</header>

<div class="container">

  <!-- ADD NEWS -->
  <div class="card">
    <h3>Add News</h3>
    <input id="title" placeholder="News Title">
    <textarea id="content" rows="4" placeholder="News Content"></textarea>
    <select id="category">
      <option value="">Select Category</option>
      <option value="gaming">Gaming</option>
      <option value="esports">Esports</option>
      <option value="community">Community</option>
    </select>
    <button onclick="addNews()">Publish News</button>
    <div class="status" id="status"></div>
  </div>

  <!-- SEND NOTIFICATION -->
  <div class="card">
    <h3>Send Notification (Inâ€‘App)</h3>
    <input id="notifyText" placeholder="Notification text">
    <button onclick="sendNotification()">Send Notification</button>
  </div>

  <!-- NEWS LIST -->
  <div class="card">
    <h3>Latest News</h3>
    <div id="newsList">Loading...</div>
  </div>

</div>

<!-- FIREBASE (Firestore ONLY) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, collection, addDoc, serverTimestamp,
  query, orderBy, onSnapshot, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* ðŸ”´ APNI CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyC9Cfh60ZyeZTbhK45a_sKWBFCy8DrqDao",
  authDomain: "ehtisham-news.firebaseapp.com",
  projectId: "ehtisham-news",
  storageBucket: "ehtisham-news.appspot.com",
  messagingSenderId: "52980900534",
  appId: "1:52980900534:web:3595bef67929dd1c727c17"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ADD NEWS */
window.addNews = async ()=>{
  const title = titleEl.value.trim();
  const content = contentEl.value.trim();
  const category = categoryEl.value;
  if(!title || !content || !category){
    statusEl.style.color="red"; statusEl.innerText="Fill all fields"; return;
  }
  await addDoc(collection(db,"news"),{
    title, content, category,
    status:"published",
    createdAt: serverTimestamp()
  });
  statusEl.style.color="green"; statusEl.innerText="Published";
  titleEl.value=""; contentEl.value=""; categoryEl.value="";
};

/* SEND NOTIFICATION (Inâ€‘App) */
window.sendNotification = async ()=>{
  const text = notifyText.value.trim();
  if(!text) return alert("Write notification");
  await addDoc(collection(db,"notifications"),{
    text, createdAt: serverTimestamp()
  });
  notifyText.value="";
  alert("Notification Sent");
};

/* LIST + DELETE NEWS */
const q = query(collection(db,"news"), orderBy("createdAt","desc"));
onSnapshot(q,(snap)=>{
  let html="";
  snap.forEach(d=>{
    const n=d.data();
    html+=`
      <div class="news-item">
        <b>${n.title}</b><br>
        <small>${n.category}</small>
        <div class="flex">
          <button class="small danger" onclick="deleteNews('${d.id}')">Delete</button>
        </div>
      </div>`;
  });
  newsList.innerHTML = html || "No news";
});

window.deleteNews = async (id)=>{
  if(confirm("Delete this news?")){
    await deleteDoc(doc(db,"news",id));
    alert("Deleted");
  }
};

/* DOM refs */
const titleEl = document.getElementById("title");
const contentEl = document.getElementById("content");
const categoryEl = document.getElementById("category");
const statusEl = document.getElementById("status");
const notifyText = document.getElementById("notifyText");
const newsList = document.getElementById("newsList");
</script>

</body>
</html>
